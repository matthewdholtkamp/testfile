<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PROJECT LONGEVITY — Pipeline Dashboard</title>
  <style>
    :root{
      --bg:#0d1117; --text:#c9d1d9; --muted:#8b949e;
      --panel:#161b22; --border:#30363d; --accent:#58a6ff;
      --good:#2ea043; --warn:#d29922; --bad:#da3633;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      --sans: -apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif;
    }
    *{box-sizing:border-box}
    body{
      font-family:var(--sans);
      background:var(--bg);
      color:var(--text);
      margin:0;
      padding:20px;
    }
    .container{max-width:1200px;margin:0 auto;}
    header{
      display:flex;justify-content:space-between;align-items:center;gap:12px;
      margin-bottom:20px;padding-bottom:16px;border-bottom:1px solid var(--border);
      flex-wrap:wrap;
    }
    h1{margin:0;font-size:20px;letter-spacing:0.2px}
    .subhead{color:var(--muted);font-size:13px;margin-top:4px}
    .actions{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .actions input[type="password"], .actions input[type="text"]{
      width:240px;max-width:60vw;
      padding:8px;background:#0b0f14;border:1px solid var(--border);
      color:var(--text);border-radius:6px;
    }
    .actions button, button{
      background:var(--accent);color:#fff;border:none;
      padding:9px 12px;border-radius:6px;cursor:pointer;
      font-weight:600;font-size:13px;
    }
    button:hover{opacity:.92}
    button.secondary{background:transparent;border:1px solid var(--border);color:var(--text)}
    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline}

    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(320px,1fr));
      gap:16px;
    }
    .panel{
      background:var(--panel);border:1px solid var(--border);
      border-radius:10px;padding:16px;
    }
    .panel h2{
      margin:0 0 12px 0;font-size:15px;
      padding-bottom:10px;border-bottom:1px solid var(--border);
      display:flex;align-items:center;justify-content:space-between;gap:10px;
    }
    .pill{
      font-size:12px;border:1px solid var(--border);
      padding:3px 8px;border-radius:999px;color:var(--muted)
    }
    .status-list{display:grid;gap:10px}
    .row{display:flex;justify-content:space-between;gap:12px;font-size:13px}
    .value{font-family:var(--mono)}
    .ok{color:var(--good)} .bad{color:var(--bad)} .warn{color:var(--warn)}
    .small{font-size:12px;color:var(--muted)}
    .error-log{
      background:#0b0f14;border:1px solid var(--border);
      color:var(--bad);padding:10px;border-radius:8px;
      font-family:var(--mono);font-size:12px;height:140px;overflow:auto;
      white-space:pre-wrap;
    }
    textarea{
      width:100%;padding:10px;border-radius:8px;
      background:#0b0f14;border:1px solid var(--border);
      color:var(--text);font-family:var(--mono);font-size:12px;
      min-height:220px;
    }
    label{display:block;margin:10px 0 6px;font-weight:700;font-size:12px;color:var(--muted)}
    select,input[type="number"],input[type="text"]{
      width:100%;padding:8px;border-radius:8px;
      background:#0b0f14;border:1px solid var(--border);
      color:var(--text);
    }
    .two{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .kpi{
      display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px;margin-top:8px
    }
    .card{
      border:1px solid var(--border);border-radius:10px;padding:12px;background:#0b0f14;
    }
    .card .t{font-size:12px;color:var(--muted)}
    .card .n{font-size:18px;font-family:var(--mono);margin-top:4px}
    .step{
      display:flex;align-items:center;justify-content:space-between;
      padding:10px;border:1px solid var(--border);border-radius:10px;background:#0b0f14;margin-top:10px;
      font-size:13px;
    }
    .step .name{font-weight:700}
    .step .meta{font-family:var(--mono);font-size:12px;color:var(--muted)}
    .step .state{font-weight:800}
    .divider{height:1px;background:var(--border);margin:12px 0;opacity:.7}
    .hint{color:var(--muted);font-size:12px;line-height:1.35}
    .btnrow{display:flex;gap:10px;flex-wrap:wrap}
    .mono{font-family:var(--mono)}
  </style>
</head>
<body>
<div class="container">
  <header>
    <div>
      <h1>PROJECT LONGEVITY — Autonomous Research Pipeline</h1>
      <div class="subhead">Ingest → Extract → Validate → Sync. Deterministic scoring. Daily UTC run.</div>
    </div>

    <div class="actions">
      <input type="text" id="repo" value="matthewdholtkamp/testfile" title="owner/repo" />
      <input type="password" id="gh-token" placeholder="GitHub PAT (optional)" />
      <button onclick="refreshAll()">Refresh</button>
      <button class="secondary" onclick="triggerWorkflow()">Run Now</button>
      <a id="repoLink" href="https://github.com/matthewdholtkamp/testfile" target="_blank">View Repo</a>
    </div>
  </header>

  <div class="grid">

    <!-- System Status -->
    <div class="panel">
      <h2>
        System Status
        <span class="pill" id="statusPill">loading</span>
      </h2>

      <div class="kpi">
        <div class="card">
          <div class="t">Last Run (UTC)</div>
          <div class="n" id="kpiLastRun">—</div>
        </div>
        <div class="card">
          <div class="t">Run Date (UTC)</div>
          <div class="n" id="kpiRunDate">—</div>
        </div>
        <div class="card">
          <div class="t">Papers Ingested</div>
          <div class="n" id="kpiPapers">—</div>
        </div>
        <div class="card">
          <div class="t">Claims Extracted</div>
          <div class="n" id="kpiClaims">—</div>
        </div>
        <div class="card">
          <div class="t">Claims Validated</div>
          <div class="n" id="kpiValidated">—</div>
        </div>
        <div class="card">
          <div class="t">Errors / Warnings</div>
          <div class="n" id="kpiErrors">—</div>
        </div>
      </div>

      <div class="divider"></div>

      <div class="step">
        <div>
          <div class="name">Ingestion</div>
          <div class="meta" id="stepIngestMeta">—</div>
        </div>
        <div class="state" id="stepIngestState">—</div>
      </div>

      <div class="step">
        <div>
          <div class="name">Extraction</div>
          <div class="meta" id="stepExtractMeta">—</div>
        </div>
        <div class="state" id="stepExtractState">—</div>
      </div>

      <div class="step">
        <div>
          <div class="name">Validation</div>
          <div class="meta" id="stepValidateMeta">—</div>
        </div>
        <div class="state" id="stepValidateState">—</div>
      </div>

      <div class="step">
        <div>
          <div class="name">Drive Sync</div>
          <div class="meta" id="stepSyncMeta">—</div>
        </div>
        <div class="state" id="stepSyncState">—</div>
      </div>

      <div class="divider"></div>

      <div class="btnrow">
        <button class="secondary" onclick="openTodayFile('00_ADMIN/pipeline_status.json')">Open pipeline_status.json</button>
        <button class="secondary" onclick="openTodayFile(todayResultsPath('claims_extracted.json'))">Open claims_extracted.json</button>
        <button class="secondary" onclick="openTodayFile(todayResultsPath('validated_claims.json'))">Open validated_claims.json</button>
      </div>

      <label>Recent Errors / Warnings</label>
      <div class="error-log" id="errorLog">Loading…</div>
      <div class="hint" style="margin-top:10px">
        If this shows “Not found” and your repo is private, enter a GitHub PAT so the dashboard can fetch via the GitHub API.
      </div>
    </div>

    <!-- Config Editor -->
    <div class="panel">
      <h2>Configuration <span class="pill">config/config.json</span></h2>

      <div class="btnrow">
        <button class="secondary" onclick="document.getElementById('config-upload').click()">Load Local Config</button>
        <input type="file" id="config-upload" style="display:none" accept=".json" onchange="loadConfigFromFile(this)">
        <button onclick="downloadConfig()">Download Edited Config</button>
        <button class="secondary" onclick="fetchRepoConfig()">Fetch From Repo</button>
      </div>

      <label>Raw JSON (edit here)</label>
      <textarea id="rawConfig"></textarea>

      <div class="btnrow" style="margin-top:10px">
        <button class="secondary" onclick="validateJson()">Validate JSON</button>
        <button onclick="applyConfig()">Apply to UI (local only)</button>
      </div>

      <div class="divider"></div>

      <div class="hint">
        This dashboard cannot push config changes back to GitHub without committing via API. Treat this as an editor/exporter unless you build a secure backend.
      </div>
    </div>

    <!-- Controls aligned to pipeline -->
    <div class="panel">
      <h2>Pipeline Controls <span class="pill">aligned</span></h2>

      <label>Gemini Model (allowlist)</label>
      <select id="geminiModel">
        <option value="gemini-2.5-flash-lite">gemini-2.5-flash-lite</option>
        <option value="gemini-2.5-flash">gemini-2.5-flash</option>
      </select>

      <div class="two">
        <div>
          <label>Max Papers / Run</label>
          <input type="number" id="maxPapers" value="10" min="0" />
        </div>
        <div>
          <label>Gemini RPM</label>
          <input type="number" id="geminiRpm" value="4" min="1" />
        </div>
      </div>

      <div class="divider"></div>

      <h3 style="margin:0 0 10px 0;font-size:14px">Validation Scoring (preview)</h3>

      <div class="two">
        <div>
          <label>Match Threshold</label>
          <input type="number" id="matchThreshold" value="20" min="0" max="100" />
        </div>
        <div>
          <label>Top K Matches</label>
          <input type="number" id="topK" value="3" min="1" max="10" />
        </div>
      </div>

      <label class="small">Tip: validator uses config.validation.scoring.*; edit in the Raw JSON panel for full control.</label>

      <div class="divider"></div>

      <label>Workflow Dispatch Command (copy/paste)</label>
      <textarea id="dispatchCurl" style="min-height:110px;"></textarea>
    </div>

    <!-- Results Preview -->
    <div class="panel">
      <h2>Today’s Outputs <span class="pill" id="todayPill">—</span></h2>

      <div class="status-list">
        <div class="row"><span>Claims directory</span><span class="value" id="claimsDir">—</span></div>
        <div class="row"><span>validated_claims.json</span><span class="value" id="validatedPath">—</span></div>
      </div>

      <div class="divider"></div>

      <label>Validated Claims — quick view (top 5)</label>
      <div class="error-log" id="validatedPreview" style="color:var(--text);height:220px">Loading…</div>

      <div class="hint" style="margin-top:10px">
        This preview shows the highest composite_confidence claims (if present). It reads today’s validated_claims.json.
      </div>
    </div>

  </div>
</div>

<script>
  // ---------- Helpers ----------
  const stopwords = new Set(["the","and","of","in","to","with","a","an","for","on","by","from"]);
  const nowUtc = () => new Date(new Date().toLocaleString("en-US",{timeZone:"UTC"}));
  const pad2 = (n) => String(n).padStart(2,"0");
  const utcYmdPath = (d = nowUtc()) => `${d.getUTCFullYear()}/${pad2(d.getUTCMonth()+1)}/${pad2(d.getUTCDate())}`;
  const todayResultsPath = (file) => `04_RESULTS/${utcYmdPath()}/${file}`;
  const todayClaimsDir = () => `04_RESULTS/${utcYmdPath()}/claims/`;

  function setPill(el, text, cls){
    el.textContent = text;
    el.className = "pill" + (cls ? ` ${cls}` : "");
  }

  function fmtState(s){
    if(!s) return {txt:"unknown", cls:"warn"};
    const t = String(s).toLowerCase();
    if(t.includes("success")) return {txt:"success", cls:"ok"};
    if(t.includes("fail") || t.includes("error")) return {txt:"fail", cls:"bad"};
    if(t.includes("running")) return {txt:"running", cls:"warn"};
    return {txt:t, cls:"warn"};
  }

  function repoFromUI(){ return (document.getElementById("repo").value || "matthewdholtkamp/testfile").trim(); }
  function tokenFromUI(){ return (document.getElementById("gh-token").value || "").trim(); }

  function repoRawUrl(path){
    // Works for public repos or if file is served by GitHub Pages at same origin.
    // If you host this in-repo as a static file, relative fetch will work.
    return path;
  }

  async function fetchWithOptionalPat(path){
    const token = tokenFromUI();
    // Try relative first (works on Pages/public files)
    try{
      const r = await fetch(repoRawUrl(path), {cache:"no-store"});
      if(r.ok) return await r.text();
    }catch(e){}

    // PAT fallback: GitHub API contents
    if(!token){
      throw new Error(`Not found (and no PAT). Path: ${path}`);
    }
    const repo = repoFromUI();
    const api = `https://api.github.com/repos/${repo}/contents/${path}`;
    const r2 = await fetch(api, {
      headers: {
        "Accept":"application/vnd.github+json",
        "Authorization": `Bearer ${token}`
      },
      cache:"no-store"
    });
    if(!r2.ok){
      throw new Error(`GitHub API error ${r2.status} for ${path}`);
    }
    const data = await r2.json();
    if(!data.content) throw new Error(`No content in API response for ${path}`);
    const decoded = atob(data.content.replace(/\n/g,""));
    return decoded;
  }

  async function fetchJsonWithOptionalPat(path){
    const txt = await fetchWithOptionalPat(path);
    return JSON.parse(txt);
  }

  function openTodayFile(path){
    const repo = repoFromUI();
    const token = tokenFromUI();
    // If PAT exists, open GitHub UI directly; otherwise open relative (Pages) or repo UI.
    if(token){
      window.open(`https://github.com/${repo}/blob/main/${path}`, "_blank");
    }else{
      // relative works if hosted in repo pages; otherwise open repo UI
      window.open(path, "_blank");
    }
  }

  // ---------- Dashboard state ----------
  let config = null;
  let status = null;

  // ---------- Render ----------
  function updateDispatchCurl(){
    const repo = repoFromUI();
    const wfFile = "daily_pipeline.yml"; // actual file name in .github/workflows
    const curl = [
      "curl -X POST \\",
      "  -H \"Accept: application/vnd.github+json\" \\",
      "  -H \"Authorization: Bearer <YOUR_GITHUB_PAT>\" \\",
      `  https://api.github.com/repos/${repo}/actions/workflows/${wfFile}/dispatches \\`,
      "  -d '{\"ref\":\"main\"}'"
    ].join("\n");
    document.getElementById("dispatchCurl").value = curl;
    document.getElementById("repoLink").href = `https://github.com/${repo}`;
  }

  function renderStatus(){
    const statusPill = document.getElementById("statusPill");
    const todayPill = document.getElementById("todayPill");
    const ymd = utcYmdPath();

    document.getElementById("kpiRunDate").textContent = ymd;
    document.getElementById("todayPill").textContent = ymd;
    document.getElementById("claimsDir").textContent = todayClaimsDir();
    document.getElementById("validatedPath").textContent = todayResultsPath("validated_claims.json");

    if(!status){
      setPill(statusPill, "no status", "warn");
      document.getElementById("kpiLastRun").textContent = "—";
      document.getElementById("kpiPapers").textContent = "—";
      document.getElementById("kpiClaims").textContent = "—";
      document.getElementById("kpiValidated").textContent = "—";
      document.getElementById("kpiErrors").textContent = "—";
      document.getElementById("errorLog").textContent = "No pipeline_status.json loaded.";
      return;
    }

    const steps = status.steps || status.pipeline_steps || {};
    // Flexible support: some implementations store as dict, some as list
    const stepLookup = {};
    if(Array.isArray(steps)){
      for(const s of steps){ stepLookup[s.step_name || s.name] = s; }
    }else{
      Object.assign(stepLookup, steps);
    }

    const ingest = stepLookup["ingest_pubmed"] || stepLookup["ingest"] || stepLookup["ingestion"];
    const extract = stepLookup["extract_claims"] || stepLookup["extract"] || stepLookup["extraction"];
    const validate = stepLookup["validate_hypotheses"] || stepLookup["validate"] || stepLookup["validation"];
    const sync = stepLookup["sync_to_drive"] || stepLookup["sync"] || stepLookup["drive_sync"];

    const lastRun = status.last_run_utc || status.updated_at_utc || status.timestamp_utc || status.last_updated || null;
    document.getElementById("kpiLastRun").textContent = lastRun ? String(lastRun).replace("T"," ").replace("Z","Z") : "—";

    const papers = (ingest && (ingest.count ?? ingest.papers ?? ingest.num_papers)) ?? status.papers_ingested ?? 0;
    const claims = (extract && (extract.count ?? extract.claims ?? extract.num_claims)) ?? status.claims_extracted ?? 0;
    const validated = (validate && (validate.count ?? validate.validated_claims ?? validate.num_validated)) ?? status.claims_validated ?? 0;

    const errors = (status.errors?.length ?? 0) + (status.warnings?.length ?? 0);

    document.getElementById("kpiPapers").textContent = String(papers);
    document.getElementById("kpiClaims").textContent = String(claims);
    document.getElementById("kpiValidated").textContent = String(validated);
    document.getElementById("kpiErrors").textContent = String(errors);

    // Step rendering
    function renderStep(metaEl, stateEl, obj){
      if(!obj){
        metaEl.textContent = "—";
        stateEl.textContent = "unknown";
        stateEl.className = "state warn";
        return;
      }
      const st = fmtState(obj.status || obj.state);
      metaEl.textContent = `count=${obj.count ?? obj.papers ?? obj.claims ?? 0}`;
      stateEl.textContent = st.txt;
      stateEl.className = "state " + st.cls;
    }

    renderStep(document.getElementById("stepIngestMeta"), document.getElementById("stepIngestState"), ingest);
    renderStep(document.getElementById("stepExtractMeta"), document.getElementById("stepExtractState"), extract);
    renderStep(document.getElementById("stepValidateMeta"), document.getElementById("stepValidateState"), validate);
    renderStep(document.getElementById("stepSyncMeta"), document.getElementById("stepSyncState"), sync);

    // Overall pill
    const overall = status.overall_status || status.status || "unknown";
    const o = fmtState(overall);
    setPill(statusPill, `overall: ${o.txt}`, o.cls);

    // Errors/warnings view
    const lines = [];
    if(Array.isArray(status.errors) && status.errors.length){
      lines.push("ERRORS:");
      for(const e of status.errors) lines.push(`- ${typeof e === "string" ? e : JSON.stringify(e)}`);
      lines.push("");
    }
    if(Array.isArray(status.warnings) && status.warnings.length){
      lines.push("WARNINGS:");
      for(const w of status.warnings) lines.push(`- ${typeof w === "string" ? w : JSON.stringify(w)}`);
      lines.push("");
    }
    if(!lines.length) lines.push("No recent errors or warnings.");
    document.getElementById("errorLog").textContent = lines.join("\n");
  }

  function renderConfig(){
    if(!config){
      document.getElementById("rawConfig").value = "";
      return;
    }
    document.getElementById("rawConfig").value = JSON.stringify(config, null, 2);

    // Best-effort fill UI fields
    const p = config.pipeline || {};
    const extraction = p.extraction || {};
    const rate = p.rate_limits || {};

    document.getElementById("geminiModel").value = extraction.gemini_model || "gemini-2.5-flash-lite";
    document.getElementById("maxPapers").value = extraction.max_papers_per_run ?? 10;
    document.getElementById("geminiRpm").value = rate.gemini_requests_per_minute ?? 4;

    const v = (config.validation && config.validation.scoring) ? config.validation.scoring : {};
    document.getElementById("matchThreshold").value = v.match_threshold ?? 20;
    document.getElementById("topK").value = v.top_k ?? 3;
  }

  // ---------- Actions ----------
  async function refreshAll(){
    updateDispatchCurl();
    // Render today pill paths
    document.getElementById("todayPill").textContent = utcYmdPath();
    document.getElementById("claimsDir").textContent = todayClaimsDir();
    document.getElementById("validatedPath").textContent = todayResultsPath("validated_claims.json");

    // 1) pipeline_status.json
    try{
      status = await fetchJsonWithOptionalPat("00_ADMIN/pipeline_status.json");
    }catch(e){
      status = null;
      document.getElementById("errorLog").textContent = `Could not load pipeline_status.json\n${e.message}`;
    }
    renderStatus();

    // 2) config/config.json
    try{
      config = await fetchJsonWithOptionalPat("config/config.json");
    }catch(e){
      // fall back silently
      config = config || null;
    }
    renderConfig();

    // 3) validated_claims.json preview
    await loadValidatedPreview();
  }

  async function fetchRepoConfig(){
    try{
      config = await fetchJsonWithOptionalPat("config/config.json");
      renderConfig();
      alert("Loaded config/config.json from repo.");
    }catch(e){
      alert("Failed to fetch config from repo: " + e.message);
    }
  }

  function validateJson(){
    try{
      JSON.parse(document.getElementById("rawConfig").value);
      alert("JSON is valid.");
    }catch(e){
      alert("Invalid JSON: " + e.message);
    }
  }

  function applyConfig(){
    try{
      config = JSON.parse(document.getElementById("rawConfig").value);
      renderConfig();
      alert("Applied JSON to UI (local only).");
    }catch(e){
      alert("Invalid JSON: " + e.message);
    }
  }

  function downloadConfig(){
    try{
      const obj = JSON.parse(document.getElementById("rawConfig").value);
      const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(obj, null, 2));
      const a = document.createElement("a");
      a.setAttribute("href", dataStr);
      a.setAttribute("download", "config.json");
      document.body.appendChild(a);
      a.click();
      a.remove();
    }catch(e){
      alert("Invalid JSON: " + e.message);
    }
  }

  function loadConfigFromFile(input){
    const file = input.files?.[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = (e) => {
      try{
        config = JSON.parse(e.target.result);
        renderConfig();
        alert("Loaded config from file.");
      }catch(err){
        alert("Could not parse JSON: " + err.message);
      }
    };
    reader.readAsText(file);
  }

  async function loadValidatedPreview(){
    const preview = document.getElementById("validatedPreview");
    preview.textContent = "Loading…";
    try{
      const v = await fetchJsonWithOptionalPat(todayResultsPath("validated_claims.json"));
      const arr = v.validated_claims || [];
      if(!arr.length){
        preview.textContent = "validated_claims.json loaded, but contains 0 validated_claims (this is normal on empty/partial days).";
        document.getElementById("kpiValidated").textContent = "0";
        return;
      }
      // sort by composite_confidence descending if present
      const sorted = [...arr].sort((a,b) => (b?.scores?.composite_confidence ?? 0) - (a?.scores?.composite_confidence ?? 0));
      const top = sorted.slice(0,5).map(c => {
        const cc = c?.scores?.composite_confidence ?? 0;
        const mid = c?.matches?.best?.hypothesis_id ?? (c?.matches?.candidates?.[0]?.hypothesis_id ?? "—");
        const txt = c?.extracted?.claim_text ?? c?.claim_text ?? "—";
        return `• ${cc.toFixed(1)} | ${mid} | ${txt}`;
      });
      preview.textContent = top.join("\n");
      document.getElementById("kpiValidated").textContent = String(arr.length);
    }catch(e){
      preview.textContent = `Could not load ${todayResultsPath("validated_claims.json")}\n${e.message}`;
    }
  }

  async function triggerWorkflow(){
    const token = tokenFromUI();
    const repo = repoFromUI();
    if(!token){
      alert("Enter a GitHub PAT (repo + workflow permissions) to trigger the workflow.\n\nA curl command is provided in the Pipeline Controls panel.");
      return;
    }
    // Find the workflow file name you use (daily_pipeline.yml)
    const wfFile = "daily_pipeline.yml";
    const url = `https://api.github.com/repos/${repo}/actions/workflows/${wfFile}/dispatches`;
    const body = { ref: "main" };

    try{
      const r = await fetch(url, {
        method: "POST",
        headers: {
          "Accept":"application/vnd.github+json",
          "Authorization": `Bearer ${token}`,
          "Content-Type":"application/json"
        },
        body: JSON.stringify(body)
      });
      if(r.status === 204){
        alert("Workflow dispatch sent. Refresh in ~1–2 minutes.");
        return;
      }
      const t = await r.text();
      throw new Error(`Dispatch failed: HTTP ${r.status} ${t}`);
    }catch(e){
      alert(e.message);
    }
  }

  // Init
  document.addEventListener("DOMContentLoaded", () => {
    updateDispatchCurl();
    document.getElementById("todayPill").textContent = utcYmdPath();
    document.getElementById("claimsDir").textContent = todayClaimsDir();
    document.getElementById("validatedPath").textContent = todayResultsPath("validated_claims.json");
    refreshAll();
  });
</script>
</body>
</html>
